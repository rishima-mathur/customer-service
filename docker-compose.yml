services:
  # ðŸ§© Customer Service (ASP.NET Core)
  customer-service:
    container_name: customer-service
    build:
      context: .                
      dockerfile: Dockerfile     
    ports:
      - "5000:8080"              
    environment:
      - ASPNETCORE_ENVIRONMENT=Development
      - ConnectionStrings__CustomerDB=Server=customer-sql,1433;Database=CustomerDB;User Id=sa;Password=StrongPass123!;TrustServerCertificate=True;
    depends_on:
        customer-sql:
            condition: service_healthy

    networks:
      - college-net
    volumes:
      - ./src/CustomerService.API/seed:/app/seed

 
  customer-sql:
    image: mcr.microsoft.com/mssql/server:2022-latest
    container_name: customer-sql
    ports:
      - "1435:1433"              
    environment:
      SA_PASSWORD: "StrongPass123!"
      ACCEPT_EULA: "Y"
    networks:
      - college-net
    volumes:
      - customer_sql_data:/var/opt/mssql 
    healthcheck:
      test: ["CMD-SHELL", "/opt/mssql-tools18/bin/sqlcmd -S localhost -U sa -P 'StrongPass123!' -Q 'SELECT 1' -C > /dev/null 2>&1 || exit 1"]
      interval: 15s
      timeout: 10s
      retries: 10
      start_period: 60s

# ðŸ•¸ Shared network for microservice communication
networks:
  college-net:
    driver: bridge

# ðŸ’¾ Persistent volume for SQL data
volumes:
  customer_sql_data:
